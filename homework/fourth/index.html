<!DOCTYPE html>
<html>
   <head>
      <meta charset=utf-8>
      <title>Tree.js scene</title>
      <style>
         body { margin: 0; }
         canvas { position: fixed; }
      </style>
   </head>
   <body>
      <script src="js/tree.min.js"></script>
      <script src="vendor/TrackballControls.js"></script>
      <script>
            var camera, controls, scene, renderer, cross;

            init();
            animate();

            function init() {
              addCamera();
              addScene();
              loadSkyBox();
              addRenderer();
              drawPlanet();
              lightsOn();

              window.addEventListener( 'resize', onWindowResize, false );
              render();
            }

            function drawPlanet() {
              var planetGeometry = new THREE.SphereGeometry(20,100,100);
              var texture = THREE.ImageUtils.loadTexture("img/planet-512.jpg");
              var normalmap = THREE.ImageUtils.loadTexture("img/normal-map-512.jpg");
              var specmap = THREE.ImageUtils.loadTexture("img/water-map-512.jpg");

              var planetMaterial = new THREE.MeshPhongMaterial();
              planetMaterial.map = texture;

              planetMaterial.specularMap = specmap;
              planetMaterial.specular = new THREE.Color( 0xff0000 );
              planetMaterial.shininess = 1;

              planetMaterial.normalMap = normalmap;
              planetMaterial.normalScale.set(-0.3,-0.3);

              planet = new THREE.Mesh(planetGeometry, planetMaterial);

              planet.material.map.wrapS = THREE.RepeatWrapping;
              planet.material.map.wrapT = THREE.RepeatWrapping;
              planet.material.normalMap.wrapS = THREE.RepeatWrapping;
              planet.material.normalMap.wrapT = THREE.RepeatWrapping;
              planet.material.specularMap.wrapS = THREE.RepeatWrapping;
              planet.material.specularMap.wrapT = THREE.RepeatWrapping;

              planet.material.map.repeat.set( 2, 1);
              planet.material.normalMap.repeat.set( 2, 1);
              planet.material.specularMap.repeat.set( 2, 1);

              planet.position.x = 5;
              planet.position.y = 0;
              planet.position.z = 0;

              scene.add(planet);
            };

            function addScene() {
              scene = new THREE.Scene();
              scene.fog = new THREE.FogExp2( 0xcccccc, 0.002 );
            };

            function addRenderer(){
              renderer = new THREE.WebGLRenderer( { antialias: false } );
              renderer.setClearColor( scene.fog.color );
              renderer.setPixelRatio( window.devicePixelRatio );
              renderer.setSize( window.innerWidth, window.innerHeight );
              document.body.appendChild(renderer.domElement );
            };

            function addCamera() {
              camera = new THREE.PerspectiveCamera( 60, window.innerWidth / window.innerHeight, 1, 1000 );
              camera.position.z = 500;

              controls = new THREE.TrackballControls( camera );

              controls.rotateSpeed = 1.0;
              controls.zoomSpeed = 1.2;
              controls.panSpeed = 0.8;

              controls.noZoom = false;
              controls.noPan = false;

              controls.staticMoving = true;
              controls.dynamicDampingFactor = 0.3;

              controls.keys = [ 65, 83, 68 ];

              controls.addEventListener( 'change', render );
            };

            function lightsOn() {
              var spotLight = new THREE.SpotLight(0xffffff);
              spotLight.position.set(-40, 60, -10);
              spotLight.intensity = 2;
              scene.add( spotLight );

              var spotLight2 = new THREE.SpotLight( 0x5192e9 );
              spotLight2.position.set(40, -60, 30);
              spotLight2.intensity = 1.5;
              scene.add(spotLight2);
            };

            function loadSkyBox() {
               var materials = [
                  createMaterial( 'img/skyX55+x.png' ), // right
                  createMaterial( 'img/skyX55-x.png' ), // left
                  createMaterial( 'img/skyX55+y.png' ), // top
                  createMaterial( 'img/skyX55-y.png' ), // bottom
                  createMaterial( 'img/skyX55+z.png' ), // back
                  createMaterial( 'img/skyX55-z.png' )  // front
              ];

              var mesh = new THREE.Mesh( new THREE.BoxGeometry( 1000, 1000, 1000, 1, 1, 1 ), new THREE.MeshFaceMaterial( materials ) );
              mesh.scale.set(-1,1,1);
              scene.add( mesh );
            }

            function createMaterial( path ) {
                var texture = THREE.ImageUtils.loadTexture(path);
                var material = new THREE.MeshBasicMaterial( { map: texture, overdraw: 0.5 } );

                return material;
            }

            function onWindowResize() {
              camera.aspect = window.innerWidth / window.innerHeight;
              camera.updateProjectionMatrix();
              renderer.setSize( window.innerWidth, window.innerHeight );
              controls.handleResize();
              render();
            }

            function animate() {
              requestAnimationFrame( animate );
              controls.update();
            };

            function render() {
              renderer.render( scene, camera );
            };
        </script>
   </body>
</html>
